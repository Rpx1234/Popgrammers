{"version":3,"sources":["../../src/utils/Semaphore.ts"],"names":["Semaphore","acquire","available","Promise","resolve","resolver","queue","push","release","length","Error","nextResolver","shift"],"mappings":";;;;;;;;;AAAO,MAAMA,SAAN,CAAgB;AAAA;AAAA,mCACa,EADb;;AAAA,uCAET,CAFS;AAAA;;AAIR,QAAPC,OAAO,GAAqB;AAChC,QAAI,KAAKC,SAAL,GAAiB,CAArB,EAAwB;AACtB,WAAKA,SAAL,IAAkB,CAAlB;AACA,aAAOC,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;AACD,KAJ+B,CAMhC;AACA;;;AACA,WAAO,IAAID,OAAJ,CAAYE,QAAQ,IAAI,KAAKC,KAAL,CAAWC,IAAX,CAAgBF,QAAhB,CAAxB,CAAP;AACD;;AAEDG,EAAAA,OAAO,GAAG;AACR,SAAKN,SAAL,IAAkB,CAAlB;;AAEA,QAAI,KAAKA,SAAL,GAAiB,CAAjB,IAAsB,KAAKI,KAAL,CAAWG,MAAX,GAAoB,CAA9C,EAAiD;AAC/C,YAAM,IAAIC,KAAJ,CAAU,mEAAV,CAAN;AACD,KAFD,MAEO,IAAI,KAAKR,SAAL,KAAmB,CAAnB,IAAwB,KAAKI,KAAL,CAAWG,MAAX,GAAoB,CAAhD,EAAmD;AACxD;AACA;AACA,WAAKP,SAAL,IAAkB,CAAlB;AAEA,YAAMS,YAAY,GAAG,KAAKL,KAAL,CAAWM,KAAX,EAArB;;AACA,UAAID,YAAJ,EAAkB;AAChBA,QAAAA,YAAY,CAAC,IAAD,CAAZ;AACD;AACF;AACF;;AA9BoB","sourcesContent":["export class Semaphore {\n  queue: ((v: boolean) => void)[] = [];\n  available = 1;\n\n  async acquire(): Promise<boolean> {\n    if (this.available > 0) {\n      this.available -= 1;\n      return Promise.resolve(true);\n    }\n\n    // If there is no permit available, we return a promise that resolves once the semaphore gets\n    // signaled enough times that \"available\" is equal to one.\n    return new Promise(resolver => this.queue.push(resolver));\n  }\n\n  release() {\n    this.available += 1;\n\n    if (this.available > 1 && this.queue.length > 0) {\n      throw new Error('this.available should never be > 0 when there is someone waiting.');\n    } else if (this.available === 1 && this.queue.length > 0) {\n      // If there is someone else waiting, immediately consume the permit that was released\n      // at the beginning of this function and let the waiting function resume.\n      this.available -= 1;\n\n      const nextResolver = this.queue.shift();\n      if (nextResolver) {\n        nextResolver(true);\n      }\n    }\n  }\n}\n"],"file":"Semaphore.js"}