{"version":3,"sources":["../../src/detach/IosPlist.ts"],"names":["spawnAsyncThrowError","ExponentTools","_getNormalizedPlistFilename","plistName","plistFilename","indexOf","modifyAsync","plistPath","transform","configPlistName","path","join","configFilename","config","process","platform","configContents","fs","readFile","JSON","parse","e","logger","info","plist","readFileSync","copyFileSync","writeFile","stringify","build","createBlankAsync","emptyConfig","tmpConfigFile","removeSync"],"mappings":"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","sourcesContent":["import plist from '@expo/plist';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nimport { ExponentTools, LoggerDetach as logger } from '../internal';\n\nconst { spawnAsyncThrowError } = ExponentTools;\n\nfunction _getNormalizedPlistFilename(plistName: string) {\n  let plistFilename;\n  if (plistName.indexOf('.') !== -1) {\n    plistFilename = plistName;\n  } else {\n    plistFilename = `${plistName}.plist`;\n  }\n  return plistFilename;\n}\n\n/**\n *  @param plistName base filename of property list. if no extension, assumes .plist\n */\nasync function modifyAsync(plistPath: string, plistName: string, transform: (config: any) => any) {\n  const plistFilename = _getNormalizedPlistFilename(plistName);\n  const configPlistName = path.join(plistPath, plistFilename);\n  const configFilename = path.join(plistPath, `${plistName}.json`);\n\n  // grab original plist as json object\n  let config;\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'json',\n      configPlistName,\n      '-o',\n      configFilename,\n    ]);\n    const configContents = await fs.readFile(configFilename, 'utf8');\n\n    try {\n      config = JSON.parse(configContents);\n    } catch (e) {\n      logger.info(`Error parsing ${configFilename}`, e);\n      logger.info('The erroneous file contents was:', configContents);\n      config = {};\n    }\n  } else {\n    config = plist.parse(fs.readFileSync(configPlistName, 'utf8'));\n  }\n\n  // apply transformation\n  config = await transform(config);\n\n  // back up old plist and swap in modified one\n  fs.copyFileSync(configPlistName, `${configPlistName}.bak`);\n  await fs.writeFile(configFilename, JSON.stringify(config));\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      configFilename,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, plist.build(config));\n  }\n\n  return config;\n}\n\nasync function createBlankAsync(plistPath: string, plistName: string) {\n  // write empty json file\n  const emptyConfig = {};\n  const tmpConfigFile = path.join(plistPath, `${plistName}.json`);\n  await fs.writeFile(tmpConfigFile, JSON.stringify(emptyConfig));\n\n  // convert to plist\n  const plistFilename = _getNormalizedPlistFilename(plistName);\n  const configPlistName = path.join(plistPath, plistFilename);\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      tmpConfigFile,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, JSON.stringify(plist.build(emptyConfig)));\n  }\n\n  // remove tmp json file\n  fs.removeSync(tmpConfigFile);\n}\n\nexport { modifyAsync, createBlankAsync };\n"],"file":"IosPlist.js"}