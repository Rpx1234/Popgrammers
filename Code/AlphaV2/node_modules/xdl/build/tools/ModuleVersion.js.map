{"version":3,"sources":["../../src/tools/ModuleVersion.ts"],"names":["createModuleVersionChecker","name","currentVersion","UpdateCacher","FsCache","Cacher","pkgJson","version","latestVersion","deprecated","checkAsync","getAsync","updateIsAvailable","semver","gt","latest","current"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA;AACA,SAASA,0BAAT,CAAoCC,IAApC,EAAkDC,cAAlD,EAA0E;AACxE,QAAMC,YAAY,GAAG,KAAIC,oBAAQC,MAAZ,EACnB,YAAY;AACV,UAAMC,OAAO,GAAG,MAAM,yBAAS,4BAAeL,IAAf,EAAqB;AAAEM,MAAAA,OAAO,EAAEL;AAAX,KAArB,CAAT,EAA4D,IAA5D,CAAtB;AACA,WAAO;AACLM,MAAAA,aAAa,EAAE,MAAM,yBAAS,8BAAmBP,IAAnB,CAAT,EAAmC,IAAnC,CADhB;AAELQ,MAAAA,UAAU,EAAEH,OAAO,CAACG;AAFf,KAAP;AAID,GAPkB,EAQlB,GAAER,IAAK,eARW,EASnB,KAAK,EAAL,GAAU,EAAV,GAAe,IATI,CASC;AATD,GAArB;;AAYA,iBAAeS,UAAf,GAA4B;AAC1B,UAAM;AAAEF,MAAAA,aAAF;AAAiBC,MAAAA;AAAjB,QAAgC,MAAMN,YAAY,CAACQ,QAAb,EAA5C;AACA,WAAO;AACLC,MAAAA,iBAAiB,EAAEC,kBAAOC,EAAP,CAAUN,aAAV,EAAyBN,cAAzB,CADd;AAELa,MAAAA,MAAM,EAAEP,aAFH;AAGLQ,MAAAA,OAAO,EAAEd,cAHJ;AAILO,MAAAA;AAJK,KAAP;AAMD;;AAED,SAAO;AAAEC,IAAAA;AAAF,GAAP;AACD","sourcesContent":["import latestVersionAsync from 'latest-version';\nimport pTimeout from 'p-timeout';\nimport npmPackageJson from 'package-json';\nimport semver from 'semver';\n\nimport { FsCache } from '../internal';\n\n/** @deprecated just use the update-check npm package */\nfunction createModuleVersionChecker(name: string, currentVersion: string) {\n  const UpdateCacher = new FsCache.Cacher(\n    async () => {\n      const pkgJson = await pTimeout(npmPackageJson(name, { version: currentVersion }), 2000);\n      return {\n        latestVersion: await pTimeout(latestVersionAsync(name), 2000),\n        deprecated: pkgJson.deprecated,\n      };\n    },\n    `${name}-updates.json`,\n    24 * 60 * 60 * 1000 // one day\n  );\n\n  async function checkAsync() {\n    const { latestVersion, deprecated } = await UpdateCacher.getAsync();\n    return {\n      updateIsAvailable: semver.gt(latestVersion, currentVersion),\n      latest: latestVersion,\n      current: currentVersion,\n      deprecated,\n    };\n  }\n\n  return { checkAsync };\n}\n\nexport { createModuleVersionChecker };\n"],"file":"ModuleVersion.js"}