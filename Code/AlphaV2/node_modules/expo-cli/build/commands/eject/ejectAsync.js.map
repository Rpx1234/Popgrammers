{"version":3,"sources":["../../../src/commands/eject/ejectAsync.ts"],"names":["userWantsToEjectWithoutUpgradingAsync","answer","message","ejectAsync","projectRoot","platforms","options","results","legacyUpdates","actionAsync","platform","exp","npm","packageManager","Versions","lteSdkVersion","force","CommandError","Log","debug"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA,eAAeA,qCAAf,GAAuD;AACrD,QAAMC,MAAM,GAAG,MAAM,6BAAa;AAChCC,IAAAA,OAAO,EAAG;AADsB,GAAb,CAArB;AAIA,SAAOD,MAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,eAAeE,UAAf,CACEC,WADF,EAEE;AAAEC,EAAAA,SAAF;AAAa,KAAGC;AAAhB,CAFF,EAGiB;AACf,0CAAgBD,SAAhB;AAEA,MAAI,MAAM,2CAAV,EAAuC;AACvC,QAAM,oEAA0CD,WAA1C,EAAuDC,SAAvD,CAAN;AAEA,QAAME,OAAO,GAAG,MAAM,uCAAcH,WAAd,EAA2B;AAAEC,IAAAA,SAAF;AAAa,OAAGC;AAAhB,GAA3B,CAAtB;AACA,QAAME,aAAa,GAAG,MAAM,6CAAwBJ,WAAxB,CAA5B;AACA,oCAAaG,OAAb,EAAsB;AAAEC,IAAAA;AAAF,GAAtB;AACD;;AAEM,eAAeC,WAAf,CACLL,WADK,EAEL;AACEM,EAAAA,QADF;AAEE,KAAGJ;AAFL,CAFK,EASL;AACA,QAAM;AAAEK,IAAAA;AAAF,MAAU,yBAAUP,WAAV,CAAhB;;AAEA,MAAIE,OAAO,CAACM,GAAZ,EAAiB;AACfN,IAAAA,OAAO,CAACO,cAAR,GAAyB,KAAzB;AACD,GALD,CAOA;;;AACA,MAAIC,gBAASC,aAAT,CAAuBJ,GAAvB,EAA4B,QAA5B,CAAJ,EAA2C;AACzC,QAAIL,OAAO,CAACU,KAAR,KAAkB,MAAMhB,qCAAqC,EAA7D,CAAJ,EAAsE;AACpE,YAAM,KAAIiB,uBAAJ,EACH,+FADG,CAAN;AAGD;AACF,GAND,MAMO;AACLC,mBAAIC,KAAJ,CAAU,oBAAV;;AACA,UAAMhB,UAAU,CAACC,WAAD,EAAc,EAC5B,GAAGE,OADyB;AAE5BD,MAAAA,SAAS,EAAE,8CAAsBK,QAAtB;AAFiB,KAAd,CAAhB;AAID;AACF","sourcesContent":["import { getConfig } from '@expo/config';\nimport { Versions } from 'xdl';\n\nimport CommandError from '../../CommandError';\nimport Log from '../../log';\nimport { confirmAsync } from '../../utils/prompts';\nimport { usesOldExpoUpdatesAsync } from '../utils/ProjectUtils';\nimport maybeBailOnGitStatusAsync from '../utils/maybeBailOnGitStatusAsync';\nimport { promptToClearMalformedNativeProjectsAsync } from './clearNativeFolder';\nimport { logNextSteps } from './logNextSteps';\nimport { assertPlatforms, platformsFromPlatform } from './platformOptions';\nimport { EjectAsyncOptions, prebuildAsync } from './prebuildAppAsync';\n\nasync function userWantsToEjectWithoutUpgradingAsync() {\n  const answer = await confirmAsync({\n    message: `We recommend upgrading to the latest SDK version before ejecting. SDK 37 introduces support for OTA updates and notifications in ejected projects, and includes many features that make ejecting your project easier. Would you like to continue ejecting anyways?`,\n  });\n\n  return answer;\n}\n\n/**\n * Entry point into the eject process, delegates to other helpers to perform various steps.\n *\n * 1. Verify git is clean\n * 2. Prebuild the project\n * 3. Log project info\n */\nasync function ejectAsync(\n  projectRoot: string,\n  { platforms, ...options }: EjectAsyncOptions\n): Promise<void> {\n  assertPlatforms(platforms);\n\n  if (await maybeBailOnGitStatusAsync()) return;\n  await promptToClearMalformedNativeProjectsAsync(projectRoot, platforms);\n\n  const results = await prebuildAsync(projectRoot, { platforms, ...options });\n  const legacyUpdates = await usesOldExpoUpdatesAsync(projectRoot);\n  logNextSteps(results, { legacyUpdates });\n}\n\nexport async function actionAsync(\n  projectRoot: string,\n  {\n    platform,\n    ...options\n  }: Omit<EjectAsyncOptions, 'platforms'> & {\n    npm?: boolean;\n    platform?: string;\n  }\n) {\n  const { exp } = getConfig(projectRoot);\n\n  if (options.npm) {\n    options.packageManager = 'npm';\n  }\n\n  // Set EXPO_VIEW_DIR to universe/exponent to pull expo view code locally instead of from S3 for ExpoKit\n  if (Versions.lteSdkVersion(exp, '36.0.0')) {\n    if (options.force || (await userWantsToEjectWithoutUpgradingAsync())) {\n      throw new CommandError(\n        `Ejecting to ExpoKit is now deprecated. Upgrade to Expo SDK +37 or downgrade to expo-cli@4.1.3`\n      );\n    }\n  } else {\n    Log.debug('Eject Mode: Latest');\n    await ejectAsync(projectRoot, {\n      ...options,\n      platforms: platformsFromPlatform(platform),\n    } as EjectAsyncOptions);\n  }\n}\n"],"file":"ejectAsync.js"}