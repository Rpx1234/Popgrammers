{"version":3,"sources":["../../../src/commands/eject/installNodeDependenciesAsync.ts"],"names":["installNodeDependenciesAsync","projectRoot","packageManager","clean","cleanJsDepsStep","time","Date","now","fs","remove","succeed","chalk","gray","installJsDepsStep","CreateApp","message","bold","fail","red","SilentError"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACO,eAAeA,4BAAf,CACLC,WADK,EAELC,cAFK,EAGL;AAAEC,EAAAA,KAAK,GAAG;AAAV,CAHK,EAIL;AACA,MAAIA,KAAK,IAAID,cAAc,KAAK,MAAhC,EAAwC;AACtC;AACA;AACA,UAAME,eAAe,GAAG,0BAAc,kCAAd,CAAxB;AACA,UAAMC,IAAI,GAAGC,IAAI,CAACC,GAAL,EAAb,CAJsC,CAKtC;AACA;;AACA,UAAMC,mBAAGC,MAAH,CAAU,cAAV,CAAN;AACAL,IAAAA,eAAe,CAACM,OAAhB,CACG,mCAAkCC,iBAAMC,IAAN,CAAWN,IAAI,CAACC,GAAL,KAAaF,IAAb,GAAoB,IAA/B,CAAqC,EAD1E;AAGD;;AAED,QAAMQ,iBAAiB,GAAG,0BAAc,oCAAd,CAA1B;;AACA,MAAI;AACF,UAAMR,IAAI,GAAGC,IAAI,CAACC,GAAL,EAAb;AACA,UAAMO,SAAS,GAACd,4BAAV,CAAuCC,WAAvC,EAAoDC,cAApD,CAAN;AACAW,IAAAA,iBAAiB,CAACH,OAAlB,CACG,qCAAoCC,iBAAMC,IAAN,CAAWN,IAAI,CAACC,GAAL,KAAaF,IAAb,GAAoB,IAA/B,CAAqC,EAD5E;AAGD,GAND,CAME,MAAM;AACN,UAAMU,OAAO,GAAI,uEAAsEb,cAAe,mBAAkBS,iBAAMK,IAAN,CACrH,GAAEd,cAAe,UADoG,CAEtH,kBAFF;AAGAW,IAAAA,iBAAiB,CAACI,IAAlB,CAAuBN,iBAAMO,GAAN,CAAUH,OAAV,CAAvB,EAJM,CAKN;;AACA,UAAM,KAAII,2BAAJ,EAAgBJ,OAAhB,CAAN;AACD;AACF","sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs-extra';\n\nimport { SilentError } from '../../CommandError';\nimport { logNewSection } from '../../utils/ora';\nimport * as CreateApp from '../utils/CreateApp';\n\n/**\n * Wraps PackageManager to install node modules and adds CLI logs.\n *\n * @param projectRoot\n */\nexport async function installNodeDependenciesAsync(\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm',\n  { clean = true }: { clean: boolean }\n) {\n  if (clean && packageManager !== 'yarn') {\n    // This step can take a couple seconds, if the installation logs are enabled (with EXPO_DEBUG) then it\n    // ends up looking odd to see \"Installing JavaScript dependencies\" for ~5 seconds before the logs start showing up.\n    const cleanJsDepsStep = logNewSection('Cleaning JavaScript dependencies');\n    const time = Date.now();\n    // nuke the node modules\n    // TODO: this is substantially slower, we should find a better alternative to ensuring the modules are installed.\n    await fs.remove('node_modules');\n    cleanJsDepsStep.succeed(\n      `Cleaned JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  }\n\n  const installJsDepsStep = logNewSection('Installing JavaScript dependencies');\n  try {\n    const time = Date.now();\n    await CreateApp.installNodeDependenciesAsync(projectRoot, packageManager);\n    installJsDepsStep.succeed(\n      `Installed JavaScript dependencies ${chalk.gray(Date.now() - time + 'ms')}`\n    );\n  } catch {\n    const message = `Something went wrong installing JavaScript dependencies, check your ${packageManager} logfile or run ${chalk.bold(\n      `${packageManager} install`\n    )} again manually.`;\n    installJsDepsStep.fail(chalk.red(message));\n    // TODO: actually show the error message from the package manager! :O\n    throw new SilentError(message);\n  }\n}\n"],"file":"installNodeDependenciesAsync.js"}