{"version":3,"sources":["../../../src/commands/utils/createFileTransform.ts"],"names":["escapeXMLCharacters","original","noAmps","replace","noLt","noGt","noApos","Transformer","Minipass","constructor","settings","write","data","getNormalizedName","includes","extension","name","end","replaced","IOSConfig","XcodeUtils","sanitizedName","toLowerCase","createEntryResolver","entry","path","type","test","basename","createFileTransform","extname","undefined"],"mappings":"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","sourcesContent":["import { IOSConfig } from '@expo/config-plugins';\nimport Minipass from 'minipass';\nimport * as path from 'path';\nimport { ReadEntry } from 'tar';\n\nfunction escapeXMLCharacters(original: string): string {\n  const noAmps = original.replace('&', '&amp;');\n  const noLt = noAmps.replace('<', '&lt;');\n  const noGt = noLt.replace('>', '&gt;');\n  const noApos = noGt.replace('\"', '\\\\\"');\n  return noApos.replace(\"'\", \"\\\\'\");\n}\n\nclass Transformer extends Minipass {\n  data = '';\n\n  constructor(private settings: { name: string; extension: string }) {\n    super();\n  }\n\n  write(data: string) {\n    this.data += data;\n    return true;\n  }\n\n  getNormalizedName(): string {\n    if (['.xml', '.plist'].includes(this.settings.extension)) {\n      return escapeXMLCharacters(this.settings.name);\n    }\n    return this.settings.name;\n  }\n\n  end() {\n    const name = this.getNormalizedName();\n    const replaced = this.data\n      .replace(/Hello App Display Name/g, name)\n      .replace(/HelloWorld/g, IOSConfig.XcodeUtils.sanitizedName(name))\n      .replace(/helloworld/g, IOSConfig.XcodeUtils.sanitizedName(name.toLowerCase()));\n    super.write(replaced);\n    return super.end();\n  }\n}\n\nexport function createEntryResolver(name: string) {\n  return (entry: ReadEntry) => {\n    if (name) {\n      // Rewrite paths for bare workflow\n      entry.path = entry.path\n        .replace(\n          /HelloWorld/g,\n          entry.path.includes('android')\n            ? IOSConfig.XcodeUtils.sanitizedName(name.toLowerCase())\n            : IOSConfig.XcodeUtils.sanitizedName(name)\n        )\n        .replace(/helloworld/g, IOSConfig.XcodeUtils.sanitizedName(name).toLowerCase());\n    }\n    if (entry.type && /^file$/i.test(entry.type) && path.basename(entry.path) === 'gitignore') {\n      // Rename `gitignore` because npm ignores files named `.gitignore` when publishing.\n      // See: https://github.com/npm/npm/issues/1862\n      entry.path = entry.path.replace(/gitignore$/, '.gitignore');\n    }\n  };\n}\n\nexport function createFileTransform(name: string) {\n  return (entry: ReadEntry) => {\n    const extension = path.extname(entry.path);\n\n    // Binary files, don't process these (avoid decoding as utf8)\n    if (\n      ![\n        '.png',\n        '.jpg',\n        '.jpeg',\n        '.gif',\n        '.webp',\n        '.psd',\n        '.tiff',\n        '.svg',\n        '.jar',\n        '.keystore',\n\n        // Font files\n        '.otf',\n        '.ttf',\n      ].includes(extension) &&\n      name\n    ) {\n      return new Transformer({ name, extension });\n    }\n    return undefined;\n  };\n}\n"],"file":"createFileTransform.js"}