{"version":3,"sources":["../../../src/commands/utils/glob.ts"],"names":["everyMatchAsync","pattern","options","Promise","resolve","reject","g","Glob","called","callback","er","matched","on","matches","anyMatchAsync","wrapGlobWithTimeout","query","duration","timeout","setTimeout","process","clearTimeout","error"],"mappings":";;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEO,SAASA,eAAT,CAAyBC,OAAzB,EAA0CC,OAA1C,EAA+D;AACpE,SAAO,IAAIC,OAAJ,CAAsB,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAChD,UAAMC,CAAC,GAAG,KAAIC,YAAJ,EAASN,OAAT,EAAkBC,OAAlB,CAAV;AACA,QAAIM,MAAM,GAAG,KAAb;;AACA,UAAMC,QAAQ,GAAG,CAACC,EAAD,EAAmBC,OAAnB,KAAyC;AACxD,UAAIH,MAAJ,EAAY;AACZA,MAAAA,MAAM,GAAG,IAAT;AACA,UAAIE,EAAJ,EAAQL,MAAM,CAACK,EAAD,CAAN,CAAR,KACKN,OAAO,CAACO,OAAD,CAAP;AACN,KALD;;AAMAL,IAAAA,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcH,QAAd;AACAH,IAAAA,CAAC,CAACM,EAAF,CAAK,KAAL,EAAYC,OAAO,IAAIJ,QAAQ,CAAC,IAAD,EAAOI,OAAP,CAA/B;AACD,GAXM,CAAP;AAYD;;AAEM,SAASC,aAAT,CAAuBb,OAAvB,EAAwCC,OAAxC,EAA6D;AAClE,SAAO,IAAIC,OAAJ,CAAsB,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAChD,UAAMC,CAAC,GAAG,KAAIC,YAAJ,EAASN,OAAT,EAAkBC,OAAlB,CAAV;AACA,QAAIM,MAAM,GAAG,KAAb;;AACA,UAAMC,QAAQ,GAAG,CAACC,EAAD,EAAmBC,OAAnB,KAAyC;AACxD,UAAIH,MAAJ,EAAY;AACZA,MAAAA,MAAM,GAAG,IAAT;AACA,UAAIE,EAAJ,EAAQL,MAAM,CAACK,EAAD,CAAN,CAAR,KACKN,OAAO,CAACO,OAAD,CAAP;AACN,KALD;;AAMAL,IAAAA,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcH,QAAd;AACAH,IAAAA,CAAC,CAACM,EAAF,CAAK,OAAL,EAAcD,OAAO,IAAI;AACvB;AACA;AACA;AACA;AACAF,MAAAA,QAAQ,CAAC,IAAD,EAAO,CAACE,OAAD,CAAP,CAAR;AACD,KAND;AAOAL,IAAAA,CAAC,CAACM,EAAF,CAAK,KAAL,EAAYC,OAAO,IAAIJ,QAAQ,CAAC,IAAD,EAAOI,OAAP,CAA/B;AACD,GAlBM,CAAP;AAmBD;;AAEM,SAASE,mBAAT,CACLC,KADK,EAELC,QAFK,EAGsB;AAC3B,SAAO,IAAId,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;AAC5C;AACA;AACA,UAAMa,OAAO,GAAGC,UAAU,CAAC,MAAM;AAC/Bf,MAAAA,OAAO,CAAC,KAAD,CAAP;AACD,KAFyB,EAEvBa,QAFuB,CAA1B;AAIAG,IAAAA,OAAO,CAACR,EAAR,CAAW,QAAX,EAAqB,MAAMS,YAAY,CAACH,OAAD,CAAvC;;AAEA,QAAI;AACFd,MAAAA,OAAO,CAAC,MAAMY,KAAK,EAAZ,CAAP;AACD,KAFD,CAEE,OAAOM,KAAP,EAAc;AACdjB,MAAAA,MAAM,CAACiB,KAAD,CAAN;AACD,KAJD,SAIU;AACRD,MAAAA,YAAY,CAACH,OAAD,CAAZ;AACD;AACF,GAhBM,CAAP;AAiBD","sourcesContent":["import G, { Glob } from 'glob';\n\nexport function everyMatchAsync(pattern: string, options: G.IOptions) {\n  return new Promise<string[]>((resolve, reject) => {\n    const g = new Glob(pattern, options);\n    let called = false;\n    const callback = (er: Error | null, matched: string[]) => {\n      if (called) return;\n      called = true;\n      if (er) reject(er);\n      else resolve(matched);\n    };\n    g.on('error', callback);\n    g.on('end', matches => callback(null, matches));\n  });\n}\n\nexport function anyMatchAsync(pattern: string, options: G.IOptions) {\n  return new Promise<string[]>((resolve, reject) => {\n    const g = new Glob(pattern, options);\n    let called = false;\n    const callback = (er: Error | null, matched: string[]) => {\n      if (called) return;\n      called = true;\n      if (er) reject(er);\n      else resolve(matched);\n    };\n    g.on('error', callback);\n    g.on('match', matched => {\n      // We've disabled using abort as it breaks the entire glob package across all instances.\n      // https://github.com/isaacs/node-glob/issues/279 & https://github.com/isaacs/node-glob/issues/342\n      // For now, just collect every match.\n      // g.abort();\n      callback(null, [matched]);\n    });\n    g.on('end', matches => callback(null, matches));\n  });\n}\n\nexport function wrapGlobWithTimeout(\n  query: () => Promise<string[]>,\n  duration: number\n): Promise<string[] | false> {\n  return new Promise(async (resolve, reject) => {\n    // Wait some time, then escape...\n    // Adding this because glob can sometimes freeze and fail to resolve if any other glob uses `.abort()`.\n    const timeout = setTimeout(() => {\n      resolve(false);\n    }, duration);\n\n    process.on('SIGINT', () => clearTimeout(timeout));\n\n    try {\n      resolve(await query());\n    } catch (error) {\n      reject(error);\n    } finally {\n      clearTimeout(timeout);\n    }\n  });\n}\n"],"file":"glob.js"}