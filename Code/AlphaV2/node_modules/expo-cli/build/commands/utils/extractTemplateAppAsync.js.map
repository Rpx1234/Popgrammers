{"version":3,"sources":["../../../src/commands/utils/extractTemplateAppAsync.ts"],"names":["extractAndPrepareTemplateAppAsync","npmPackageName","projectRoot","config","name","expo","cwd","appFile","JsonFile","path","join","appJson","readAsync","writeAsync","preparePackageJsonAsync","appName","packageFile","packageJson","description","tags","repository","version","private"],"mappings":";;;;;;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA;AACA;AACA;AACA;AACO,eAAeA,iCAAf,CACLC,cADK,EAELC,WAFK,EAGLC,MAHK,EAIL;AAAA;;AACA,QAAMC,IAAI,2BAAGD,MAAM,CAACC,IAAV,uDAAkBD,MAAM,CAACE,IAAP,CAAYD,IAA9B,uCAAsC,KAAhD;AAEA,QAAM,6CAAiCH,cAAjC,EAAiD;AACrDK,IAAAA,GAAG,EAAEJ,WADgD;AAErDE,IAAAA;AAFqD,GAAjD,CAAN;AAKA,QAAMG,OAAO,GAAG,KAAIC,mBAAJ,EAAaC,gBAAKC,IAAL,CAAUR,WAAV,EAAuB,UAAvB,CAAb,CAAhB;AACA,QAAMS,OAAO,GAAG,sBAAM,MAAMJ,OAAO,CAACK,SAAR,EAAZ,EAAiCT,MAAjC,CAAhB;AACA,QAAMI,OAAO,CAACM,UAAR,CAAmBF,OAAnB,CAAN;AAEA,QAAMG,uBAAuB,CAACZ,WAAD,EAAcE,IAAd,CAA7B;AAEA,SAAOF,WAAP;AACD;AAED;;;AACA,eAAeY,uBAAf,CAAuCZ,WAAvC,EAA4Da,OAA5D,EAA6E;AAC3E,QAAMC,WAAW,GAAG,KAAIR,mBAAJ,EAAaC,gBAAKC,IAAL,CAAUR,WAAV,EAAuB,cAAvB,CAAb,CAApB;AACA,QAAMe,WAAW,GAAG,MAAMD,WAAW,CAACJ,SAAZ,EAA1B,CAF2E,CAI3E;;AACA,SAAOK,WAAW,CAACC,WAAnB;AACA,SAAOD,WAAW,CAACE,IAAnB;AACA,SAAOF,WAAW,CAACG,UAAnB,CAP2E,CAS3E;;AACAH,EAAAA,WAAW,CAACb,IAAZ,GAAmB,mCAAuBW,OAAvB,CAAnB,CAV2E,CAW3E;AACA;;AACAE,EAAAA,WAAW,CAACI,OAAZ,GAAsB,OAAtB;AACAJ,EAAAA,WAAW,CAACK,OAAZ,GAAsB,IAAtB;AAEA,QAAMN,WAAW,CAACH,UAAZ,CAAuBI,WAAvB,CAAN;AACD","sourcesContent":["import { ExpoConfig } from '@expo/config';\nimport JsonFile from '@expo/json-file';\nimport merge from 'lodash/merge';\nimport path from 'path';\n\nimport { downloadAndExtractNpmModuleAsync, sanitizeNpmPackageName } from './npm';\n\n/**\n * Extract a template app to a given file path and clean up any properties left over from npm to\n * prepare it for usage.\n */\nexport async function extractAndPrepareTemplateAppAsync(\n  npmPackageName: string,\n  projectRoot: string,\n  config: { expo: Partial<ExpoConfig>; name?: string }\n) {\n  const name = config.name ?? config.expo.name ?? 'app';\n\n  await downloadAndExtractNpmModuleAsync(npmPackageName, {\n    cwd: projectRoot,\n    name,\n  });\n\n  const appFile = new JsonFile(path.join(projectRoot, 'app.json'));\n  const appJson = merge(await appFile.readAsync(), config);\n  await appFile.writeAsync(appJson);\n\n  await preparePackageJsonAsync(projectRoot, name);\n\n  return projectRoot;\n}\n\n/** Modify the template package.json, removing any extra fields and adding known properties. */\nasync function preparePackageJsonAsync(projectRoot: string, appName: string) {\n  const packageFile = new JsonFile(path.join(projectRoot, 'package.json'));\n  const packageJson = await packageFile.readAsync();\n\n  // Remove unused properties from package.json first.\n  delete packageJson.description;\n  delete packageJson.tags;\n  delete packageJson.repository;\n\n  // name and version are required for yarn workspaces (monorepos)\n  packageJson.name = sanitizeNpmPackageName(appName);\n  // These are metadata fields related to the template package, let's remove them from the package.json.\n  // A good place to start\n  packageJson.version = '1.0.0';\n  packageJson.private = true;\n\n  await packageFile.writeAsync(packageJson);\n}\n"],"file":"extractTemplateAppAsync.js"}