{"version":3,"sources":["../../../src/commands/utils/isModuleSymlinked.ts"],"names":["findUpPackageJson","root","packageJson","findUp","sync","cwd","getModuleRootPathForFile","moduleFile","moduleRoot","path","dirname","isModuleRootPathInNodeModulesFolder","moduleRootPath","parentFolderName","basename","isModuleSymlinked","projectRoot","moduleId","isSilent","modulePath","error"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASA,iBAAT,CAA2BC,IAA3B,EAAiD;AAC/C,QAAMC,WAAW,GAAGC,kBAAOC,IAAP,CAAY,cAAZ,EAA4B;AAAEC,IAAAA,GAAG,EAAEJ;AAAP,GAA5B,CAApB;;AACA,yBAAOC,WAAP,EAAqB,qCAAoCD,IAAK,GAA9D;AACA,SAAOC,WAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASI,wBAAT,CAAkCC,UAAlC,EAA8D;AAC5D;AACA,QAAML,WAAW,GAAGF,iBAAiB,CAACO,UAAD,CAArC;;AACA,QAAMC,UAAU,GAAGC,gBAAKC,OAAL,CAAaR,WAAb,CAAnB;;AACA,SAAOM,UAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASG,mCAAT,CAA6CC,cAA7C,EAA8E;AAC5E,QAAMC,gBAAgB,GAAGJ,gBAAKK,QAAL,CAAcL,gBAAKC,OAAL,CAAaE,cAAb,CAAd,CAAzB;;AACA,SAAOC,gBAAgB,KAAK,cAA5B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASE,iBAAT,CAA2B;AAChCC,EAAAA,WADgC;AAEhCC,EAAAA,QAFgC;AAGhCC,EAAAA;AAHgC,CAA3B,EAQK;AACV,MAAI;AACF,UAAMC,UAAU,GAAG,4BAAYH,WAAZ,EAAyBC,QAAzB,CAAnB;;AACA,QAAI,CAACE,UAAL,EAAiB;AACf;AACA,aAAO,KAAP;AACD,KALC,CAMF;;;AACA,UAAMP,cAAc,GAAGN,wBAAwB,CAACa,UAAD,CAA/C;AACA,WAAO,CAACR,mCAAmC,CAACC,cAAD,CAA3C;AACD,GATD,CASE,OAAOQ,KAAP,EAAc;AACd,QAAI,CAACF,QAAL,EAAe;AACb,YAAME,KAAN;AACD,KAHa,CAId;AACA;;;AACA,WAAO,KAAP;AACD;AACF","sourcesContent":["import assert from 'assert';\nimport findUp from 'find-up';\nimport path from 'path';\nimport resolveFrom from 'resolve-from';\n\n/**\n * Find the closest `package.json`.\n *\n * @example findUpPackageJson('./foo/expo/build/index.js') -> './foo/expo/package.json'\n */\nfunction findUpPackageJson(root: string): string {\n  const packageJson = findUp.sync('package.json', { cwd: root });\n  assert(packageJson, `No package.json found for module \"${root}\"`);\n  return packageJson;\n}\n\n/**\n * Return the root folder for a node module file.\n *\n * @example getModuleRootPathForFile('./foo/expo/build/index.js') -> './foo/expo'\n */\nfunction getModuleRootPathForFile(moduleFile: string): string {\n  // Get the closest package.json to the node module\n  const packageJson = findUpPackageJson(moduleFile);\n  const moduleRoot = path.dirname(packageJson);\n  return moduleRoot;\n}\n\n/**\n * Return true if the parent folder for a given file path is named \"node_modules\".\n *\n * @example\n * isModuleRootPathInNodeModulesFolder('./foo/expo') -> false\n * isModuleRootPathInNodeModulesFolder('./node_modules/expo') -> true\n */\nfunction isModuleRootPathInNodeModulesFolder(moduleRootPath: string): boolean {\n  const parentFolderName = path.basename(path.dirname(moduleRootPath));\n  return parentFolderName === 'node_modules';\n}\n\n/**\n * Given a node module name, and a project path, this method will:\n *\n * 1. Resolve the module path.\n * 2. Find the module root folder.\n * 3. Return true if the module root folder is in a folder named `node_modules`\n *\n * @param projectRoot\n * @param moduleId\n *\n * @example\n * isModuleSymlinked({\n *   projectRoot: './expo/apps/native-component-list',\n *   moduleId: 'react-native'\n * })\n */\nexport function isModuleSymlinked({\n  projectRoot,\n  moduleId,\n  isSilent,\n}: {\n  projectRoot: string;\n  moduleId: string;\n  isSilent?: boolean;\n}): boolean {\n  try {\n    const modulePath = resolveFrom(projectRoot, moduleId);\n    if (!modulePath) {\n      // module cannot be resolved (probably not installed), cannot be symlinked.\n      return false;\n    }\n    // resolve the root folder for the node module\n    const moduleRootPath = getModuleRootPathForFile(modulePath);\n    return !isModuleRootPathInNodeModulesFolder(moduleRootPath);\n  } catch (error) {\n    if (!isSilent) {\n      throw error;\n    }\n    // Failed to resolve the package.json relative to the project, not sure what to do here.\n    // This is probably not possible due to node module resolution.\n    return false;\n  }\n}\n"],"file":"isModuleSymlinked.js"}