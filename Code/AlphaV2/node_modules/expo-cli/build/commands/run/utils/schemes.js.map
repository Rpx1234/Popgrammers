{"version":3,"sources":["../../../../src/commands/run/utils/schemes.ts"],"names":["getSchemesForIosAsync","projectRoot","configPath","IOSConfig","Paths","getInfoPlistPath","rawPlist","fs","readFileSync","plistObject","plist","parse","sortLongest","Scheme","getSchemesFromPlist","getSchemesForAndroidAsync","AndroidConfig","getAndroidManifestAsync","manifest","Manifest","readAndroidManifestAsync","getSchemesFromManifest","intersecting","a","b","c","d","length","filter","value","includes","getOptionalDevClientSchemeAsync","hasIos","hasAndroid","Promise","all","ios","android","getManagedDevClientSchemeAsync","matching","exp","skipSDKVersionRequirement","getDefaultScheme","require","scheme","error","Log","warn","obj","sort"],"mappings":"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","sourcesContent":["import { getConfig } from '@expo/config';\nimport { AndroidConfig, IOSConfig } from '@expo/config-plugins';\nimport plist from '@expo/plist';\nimport fs from 'fs';\nimport resolveFrom from 'resolve-from';\n\nimport Log from '../../../log';\nimport {\n  hasRequiredAndroidFilesAsync,\n  hasRequiredIOSFilesAsync,\n} from '../../eject/clearNativeFolder';\n\nexport async function getSchemesForIosAsync(projectRoot: string) {\n  try {\n    const configPath = IOSConfig.Paths.getInfoPlistPath(projectRoot);\n    const rawPlist = fs.readFileSync(configPath, 'utf8');\n    const plistObject = plist.parse(rawPlist);\n    return sortLongest(IOSConfig.Scheme.getSchemesFromPlist(plistObject));\n  } catch {\n    // No ios folder or some other error\n    return [];\n  }\n}\n\nexport async function getSchemesForAndroidAsync(projectRoot: string) {\n  try {\n    const configPath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n    const manifest = await AndroidConfig.Manifest.readAndroidManifestAsync(configPath);\n    return sortLongest(\n      await AndroidConfig.Scheme.getSchemesFromManifest(manifest, 'expo-development-client')\n    );\n  } catch {\n    // No android folder or some other error\n    return [];\n  }\n}\n\nfunction intersecting<T>(a: T[], b: T[]): T[] {\n  const [c, d] = a.length > b.length ? [a, b] : [b, a];\n  return c.filter(value => d.includes(value));\n}\n\nexport async function getOptionalDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const [hasIos, hasAndroid] = await Promise.all([\n    hasRequiredIOSFilesAsync(projectRoot),\n    hasRequiredAndroidFilesAsync(projectRoot),\n  ]);\n\n  const [ios, android] = await Promise.all([\n    getSchemesForIosAsync(projectRoot),\n    getSchemesForAndroidAsync(projectRoot),\n  ]);\n\n  // Allow managed projects\n  if (!hasIos && !hasAndroid) {\n    return getManagedDevClientSchemeAsync(projectRoot);\n  }\n\n  let matching: string;\n  // Allow for only one native project to exist.\n  if (!hasIos) {\n    matching = android[0];\n  } else if (!hasAndroid) {\n    matching = ios[0];\n  } else {\n    [matching] = intersecting(ios, android);\n  }\n  return matching ?? null;\n}\n\nasync function getManagedDevClientSchemeAsync(projectRoot: string): Promise<string | null> {\n  const { exp } = getConfig(projectRoot, {\n    skipSDKVersionRequirement: true,\n  });\n  try {\n    const getDefaultScheme = require(resolveFrom(projectRoot, 'expo-dev-client/getDefaultScheme'));\n    const scheme = getDefaultScheme(exp);\n    return scheme;\n  } catch (error) {\n    Log.warn(\n      '\\nDevelopment build: Unable to get the default URI scheme for the project. Please make sure the expo-dev-client package is installed.'\n    );\n    // throw new CommandError(error);\n    return null;\n  }\n}\n\n// sort longest to ensure uniqueness.\n// this might be undesirable as it causes the QR code to be longer.\nfunction sortLongest(obj: string[]): string[] {\n  return obj.sort((a, b) => b.length - a.length);\n}\n"],"file":"schemes.js"}