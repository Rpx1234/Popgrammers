{"version":3,"sources":["../../../../src/commands/info/doctor/windows.ts"],"names":["execFileAsync","execFile","warnUponCmdExe","process","platform","stdout","stderr","ppid","windowsHide","startsWith","parentProcessName","match","toLowerCase","includes","console","warn"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AACA,MAAMA,aAAa,GAAG,uBAAUC,yBAAV,CAAtB;AAEA;AACA;AACA;AACA;AACA;;AACO,eAAeC,cAAf,GAAgC;AACrC,MAAIC,OAAO,CAACC,QAAR,KAAqB,OAAzB,EAAkC;AAChC;AACD,GAHoC,CAKrC;;;AACA,QAAM,CAAC,YAAY;AACjB;AACA,UAAM;AAAEC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAqB,MAAMN,aAAa,CAC5C,UAD4C,EAE5C,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,EAA8B,UAASG,OAAO,CAACI,IAAK,EAApD,CAF4C,EAG5C;AAAEC,MAAAA,WAAW,EAAE;AAAf,KAH4C,CAA9C;;AAKA,QAAI,CAACH,MAAM,CAACI,UAAP,CAAkB,EAAlB,CAAD,IAA0BH,MAAM,KAAK,EAAzC,EAA6C;AAC3C;AACA;AACA;AACA;AACD;;AAED,UAAM,CAACI,iBAAD,IAAsBL,MAAM,CAACM,KAAP,CAAa,kBAAb,KAAoC,CAAC,EAAD,CAAhE;;AACA,QAAID,iBAAiB,CAACE,WAAlB,GAAgCC,QAAhC,CAAyC,SAAzC,CAAJ,EAAyD;AACvD;AACAC,MAAAA,OAAO,CAACC,IAAR,CACE,qBACE,8IADF,CADF;AAKD;AACF,GAvBK,GAAN;AAwBD","sourcesContent":["import { yellow } from 'chalk';\nimport { execFile } from 'child_process';\nimport { promisify } from 'util';\n\n// I deliberately use `execFile` instead of `spawn`, because I expect the output of known format always.\nconst execFileAsync = promisify(execFile);\n\n/**\n * Windows only. On any other platform (including WSL on Windows) it's no-op.\n *\n * Checks whether the script is executed from `cmd.exe` and if positive suggests using other terminals.\n */\nexport async function warnUponCmdExe() {\n  if (process.platform !== 'win32') {\n    return;\n  }\n\n  // we're on Windows & we want to suggest using PowerShell instead of CMD\n  await (async () => {\n    // https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tasklist\n    const { stdout, stderr } = await execFileAsync(\n      'tasklist',\n      ['/nh', '/fo', 'csv', '/fi', `PID eq ${process.ppid}`],\n      { windowsHide: true }\n    );\n    if (!stdout.startsWith('') || stderr !== '') {\n      // Message upon no command output or wrong input is printed without '\"\" and results are printed with them.\n      // console.log(stdout);\n      // console.log(stderr);\n      return;\n    }\n\n    const [parentProcessName] = stdout.match(/(?<=^\").*?(?=\",)/) || [''];\n    if (parentProcessName.toLowerCase().includes('cmd.exe')) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        yellow(\n          'WARNING: We recommend using PowerShell or Bash via WSL 2 for development with expo-cli on Windows. You may encounter issues using cmd.exe.\\n'\n        )\n      );\n    }\n  })();\n}\n"],"file":"windows.js"}