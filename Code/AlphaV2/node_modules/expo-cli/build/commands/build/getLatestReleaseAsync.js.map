{"version":3,"sources":["../../../src/commands/build/getLatestReleaseAsync.ts"],"names":["getLatestReleaseAsync","projectRoot","options","user","UserManager","ensureLoggedInAsync","api","ApiV2","clientForUser","exp","skipSDKVersionRequirement","result","postAsync","owner","slug","releaseChannel","count","platform","queryResult","length"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAaO,eAAeA,qBAAf,CACLC,WADK,EAELC,OAFK,EAOoB;AACzB,QAAMC,IAAI,GAAG,MAAMC,mBAAYC,mBAAZ,EAAnB;;AACA,QAAMC,GAAG,GAAGC,aAAMC,aAAN,CAAoBL,IAApB,CAAZ;;AACA,QAAM;AAAEM,IAAAA;AAAF,MAAU,yBAAUR,WAAV,EAAuB;AAAES,IAAAA,yBAAyB,EAAE;AAA7B,GAAvB,CAAhB;AACA,QAAMC,MAAM,GAAG,MAAML,GAAG,CAACM,SAAJ,CAAc,iBAAd,EAAiC;AACpDC,IAAAA,KAAK,EAAEX,OAAO,CAACW,KADqC;AAEpDC,IAAAA,IAAI,EAAEL,GAAG,CAACK,IAF0C;AAGpDC,IAAAA,cAAc,EAAEb,OAAO,CAACa,cAH4B;AAIpDC,IAAAA,KAAK,EAAE,CAJ6C;AAKpDC,IAAAA,QAAQ,EAAEf,OAAO,CAACe;AALkC,GAAjC,CAArB;AAOA,QAAM;AAAEC,IAAAA;AAAF,MAAkBP,MAAxB;;AACA,MAAIO,WAAW,IAAIA,WAAW,CAACC,MAAZ,GAAqB,CAAxC,EAA2C;AACzC,WAAOD,WAAW,CAAC,CAAD,CAAlB;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF","sourcesContent":["import { getConfig } from '@expo/config';\nimport { ApiV2, UserManager } from 'xdl';\n\ntype Release = {\n  fullName: string;\n  channel: string;\n  channelId: string;\n  publicationId: string;\n  appVersion: string;\n  sdkVersion: string;\n  publishedTime: string;\n  platform: string;\n};\n\nexport async function getLatestReleaseAsync(\n  projectRoot: string,\n  options: {\n    releaseChannel: string;\n    platform: string;\n    owner?: string;\n  }\n): Promise<Release | null> {\n  const user = await UserManager.ensureLoggedInAsync();\n  const api = ApiV2.clientForUser(user);\n  const { exp } = getConfig(projectRoot, { skipSDKVersionRequirement: true });\n  const result = await api.postAsync('publish/history', {\n    owner: options.owner,\n    slug: exp.slug,\n    releaseChannel: options.releaseChannel,\n    count: 1,\n    platform: options.platform,\n  });\n  const { queryResult } = result;\n  if (queryResult && queryResult.length > 0) {\n    return queryResult[0];\n  } else {\n    return null;\n  }\n}\n"],"file":"getLatestReleaseAsync.js"}