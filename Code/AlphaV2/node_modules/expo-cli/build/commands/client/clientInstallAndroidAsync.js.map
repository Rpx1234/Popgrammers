{"version":3,"sources":["../../../src/commands/client/clientInstallAndroidAsync.ts"],"names":["actionAsync","options","device","forceLatest","latest","currentSdkConfig","ClientUpgradeUtils","getExpoSdkConfig","process","cwd","currentSdkVersion","sdkVersion","undefined","sdkVersions","Versions","sdkVersionsAsync","latestSdk","newestReleasedSdkVersionAsync","currentSdk","recommendedClient","getClient","latestClient","data","url","Log","error","chalk","bold","Android","upgradeExpoAsync","version","log","recommendedClientVersion","answer","message","availableClients","getAvailableClients","project","platform","length","targetClient","askClientToInstall","latestSdkVersion","clients","clientUrl"],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport { Android, Versions } from 'xdl';\n\nimport Log from '../../log';\nimport { confirmAsync } from '../../utils/prompts';\nimport { resolveDeviceAsync } from '../run/android/resolveDeviceAsync';\nimport * as ClientUpgradeUtils from '../utils/ClientUpgradeUtils';\n\ntype Options = {\n  latest?: boolean;\n  device?: boolean | string;\n};\n\nexport async function actionAsync(options: Options) {\n  const device = await resolveDeviceAsync(options.device);\n  const forceLatest = !!options.latest;\n  const currentSdkConfig = await ClientUpgradeUtils.getExpoSdkConfig(process.cwd());\n  const currentSdkVersion = currentSdkConfig ? currentSdkConfig.sdkVersion : undefined;\n  const sdkVersions = await Versions.sdkVersionsAsync();\n  const latestSdk = await Versions.newestReleasedSdkVersionAsync();\n  const currentSdk = sdkVersions[currentSdkVersion!];\n  const recommendedClient = ClientUpgradeUtils.getClient('android', currentSdk);\n  const latestClient = ClientUpgradeUtils.getClient('android', latestSdk.data);\n\n  if (forceLatest) {\n    if (!latestClient?.url) {\n      Log.error(\n        `Unable to find latest client version. Check your internet connection or run this command again without the ${chalk.bold(\n          '--latest'\n        )} flag.`\n      );\n      return;\n    }\n\n    if (\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient.url,\n        version: latestClient.version,\n      })\n    ) {\n      Log.log('Done!');\n    } else {\n      Log.error(`Unable to install Expo Go ${latestClient.version} for Android.`);\n    }\n\n    return;\n  }\n\n  if (!currentSdkVersion) {\n    Log.log(\n      'Could not find your Expo project. If you run this from a project, we can help pick the right Expo Go version!'\n    );\n  }\n\n  if (currentSdk && !recommendedClient) {\n    Log.log(\n      `You are currently using SDK ${currentSdkVersion}. Unfortunately, we couldn't detect the proper client version for this SDK.`\n    );\n  }\n\n  if (currentSdk && recommendedClient) {\n    const recommendedClientVersion = recommendedClient.version || 'version unknown';\n    const answer = await confirmAsync({\n      message: `You are currently using SDK ${currentSdkVersion}. Would you like to install client ${recommendedClientVersion} released for this SDK?`,\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: recommendedClient.url,\n        version: recommendedClient.version,\n      });\n      Log.log('Done!');\n      return;\n    }\n  } else {\n    const answer = await confirmAsync({\n      message: latestClient?.version\n        ? chalk`Do you want to install the latest client? {dim (${latestClient.version})}`\n        : 'Do you want to install the latest client?',\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient?.url,\n        version: latestClient?.version,\n      });\n      Log.log('Done!');\n      return;\n    }\n  }\n\n  const availableClients = ClientUpgradeUtils.getAvailableClients({\n    sdkVersions,\n    project: currentSdkConfig,\n    platform: 'android',\n  });\n\n  if (availableClients.length === 0) {\n    const answer = await confirmAsync({\n      message: currentSdk\n        ? `We don't have a compatible client for SDK ${currentSdkVersion}. Do you want to try the latest client?`\n        : \"It looks like we don't have a compatible client. Do you want to try the latest client?\",\n    });\n    if (answer) {\n      await Android.upgradeExpoAsync({\n        device,\n        url: latestClient?.url,\n        version: latestClient?.version,\n      });\n      Log.log('Done!');\n    } else {\n      Log.log('No client to install');\n    }\n    return;\n  }\n\n  const targetClient = await ClientUpgradeUtils.askClientToInstall({\n    currentSdkVersion,\n    latestSdkVersion: latestSdk.version,\n    clients: availableClients,\n  });\n\n  if (await Android.upgradeExpoAsync({ device, url: targetClient.clientUrl })) {\n    Log.log('Done!');\n  }\n}\n"],"file":"clientInstallAndroidAsync.js"}