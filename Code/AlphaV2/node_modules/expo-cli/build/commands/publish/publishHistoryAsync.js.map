{"version":3,"sources":["../../../src/commands/publish/publishHistoryAsync.ts"],"names":["HORIZ_CELL_WIDTH_SMALL","HORIZ_CELL_WIDTH_MEDIUM","HORIZ_CELL_WIDTH_BIG","actionAsync","projectRoot","options","result","raw","Log","log","JSON","stringify","queryResult","length","sampleItem","generalTableString","table","printTableJson","fullName","hasRuntimeVersion","some","publication","runtimeVersion","hasSdkVersion","sdkVersion","headers","colWidths","bigCells","Set","mediumCells","forEach","header","has","push","resultRows","map","publishedTime","tableString","printTableJsonArray","Error"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA,MAAMA,sBAAsB,GAAG,EAA/B;AACA,MAAMC,uBAAuB,GAAG,EAAhC;AACA,MAAMC,oBAAoB,GAAG,EAA7B;;AAEO,eAAeC,WAAf,CAA2BC,WAA3B,EAAgDC,OAAhD,EAAyE;AAC9E,QAAMC,MAAM,GAAG,MAAM,4CAAuBF,WAAvB,EAAoCC,OAApC,CAArB;;AAEA,MAAIA,OAAO,CAACE,GAAZ,EAAiB;AACfC,mBAAIC,GAAJ,CAAQC,IAAI,CAACC,SAAL,CAAeL,MAAf,CAAR;;AACA;AACD;;AAED,MAAIA,MAAM,CAACM,WAAP,IAAsBN,MAAM,CAACM,WAAP,CAAmBC,MAAnB,GAA4B,CAAtD,EAAyD;AACvD;AACA,UAAMC,UAAU,GAAGR,MAAM,CAACM,WAAP,CAAmB,CAAnB,CAAnB,CAFuD,CAEb;;AAC1C,UAAMG,kBAAkB,GAAGC,KAAK,GAACC,cAAN,CACzB;AACEC,MAAAA,QAAQ,EAAEJ,UAAU,CAACI;AADvB,KADyB,EAIzB,cAJyB,CAA3B;;AAMAV,mBAAIC,GAAJ,CAAQM,kBAAR;;AAEA,UAAMI,iBAAiB,GAAGb,MAAM,CAACM,WAAP,CAAmBQ,IAAnB,CACvBC,WAAD,IAA8B,CAAC,CAACA,WAAW,CAACC,cADpB,CAA1B;AAGA,UAAMC,aAAa,GAAGjB,MAAM,CAACM,WAAP,CAAmBQ,IAAnB,CACnBC,WAAD,IAA8B,CAAC,CAACA,WAAW,CAACG,UADxB,CAAtB,CAduD,CAkBvD;;AACA,UAAMC,OAAO,GAAG,CACd,eADc,EAEd,YAFc,EAGd,IAAIF,aAAa,GAAG,CAAC,YAAD,CAAH,GAAoB,EAArC,CAHc,EAId,IAAIJ,iBAAiB,GAAG,CAAC,gBAAD,CAAH,GAAwB,EAA7C,CAJc,EAKd,UALc,EAMd,SANc,EAOd,eAPc,CAAhB,CAnBuD,CA6BvD;;AACA,UAAMO,SAAmB,GAAG,EAA5B;AACA,UAAMC,QAAQ,GAAG,IAAIC,GAAJ,CAAQ,CAAC,eAAD,EAAkB,eAAlB,EAAmC,SAAnC,CAAR,CAAjB;AACA,UAAMC,WAAW,GAAG,IAAID,GAAJ,CAAQ,CAAC,gBAAD,CAAR,CAApB;AACAH,IAAAA,OAAO,CAACK,OAAR,CAAgBC,MAAM,IAAI;AACxB,UAAIJ,QAAQ,CAACK,GAAT,CAAaD,MAAb,CAAJ,EAA0B;AACxBL,QAAAA,SAAS,CAACO,IAAV,CAAe/B,oBAAf;AACD,OAFD,MAEO,IAAI2B,WAAW,CAACG,GAAZ,CAAgBD,MAAhB,CAAJ,EAA6B;AAClCL,QAAAA,SAAS,CAACO,IAAV,CAAehC,uBAAf;AACD,OAFM,MAEA;AACLyB,QAAAA,SAAS,CAACO,IAAV,CAAejC,sBAAf;AACD;AACF,KARD;AASA,UAAMkC,UAAyB,GAAG5B,MAAM,CAACM,WAAP,CAAmBuB,GAAnB,CAAwBd,WAAD,KAA+B,EACtF,GAAGA,WADmF;AAEtFe,MAAAA,aAAa,EAAE,2BAAWf,WAAW,CAACe,aAAvB,EAAsC,4BAAtC;AAFuE,KAA/B,CAAvB,CAAlC;AAIA,UAAMC,WAAW,GAAGrB,KAAK,GAACsB,mBAAN,CAA0Bb,OAA1B,EAAmCS,UAAnC,EAA+CR,SAA/C,CAApB;;AACAlB,mBAAIC,GAAJ,CAAQ4B,WAAR;AACD,GAhDD,MAgDO;AACL,UAAM,IAAIE,KAAJ,CAAU,uCAAV,CAAN;AACD;AACF","sourcesContent":["import dateFormat from 'dateformat';\n\nimport Log from '../../log';\nimport { getPublishHistoryAsync, HistoryOptions, Publication } from '../utils/PublishUtils';\nimport * as table from '../utils/cli-table';\n\nconst HORIZ_CELL_WIDTH_SMALL = 15;\nconst HORIZ_CELL_WIDTH_MEDIUM = 20;\nconst HORIZ_CELL_WIDTH_BIG = 40;\n\nexport async function actionAsync(projectRoot: string, options: HistoryOptions) {\n  const result = await getPublishHistoryAsync(projectRoot, options);\n\n  if (options.raw) {\n    Log.log(JSON.stringify(result));\n    return;\n  }\n\n  if (result.queryResult && result.queryResult.length > 0) {\n    // Print general publication info\n    const sampleItem = result.queryResult[0]; // get a sample item\n    const generalTableString = table.printTableJson(\n      {\n        fullName: sampleItem.fullName,\n      },\n      'General Info'\n    );\n    Log.log(generalTableString);\n\n    const hasRuntimeVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.runtimeVersion\n    );\n    const hasSdkVersion = result.queryResult.some(\n      (publication: Publication) => !!publication.sdkVersion\n    );\n\n    // Print info specific to each publication\n    const headers = [\n      'publishedTime',\n      'appVersion',\n      ...(hasSdkVersion ? ['sdkVersion'] : []),\n      ...(hasRuntimeVersion ? ['runtimeVersion'] : []),\n      'platform',\n      'channel',\n      'publicationId',\n    ];\n\n    // colWidths contains the cell size of each header\n    const colWidths: number[] = [];\n    const bigCells = new Set(['publicationId', 'publishedTime', 'channel']);\n    const mediumCells = new Set(['runtimeVersion']);\n    headers.forEach(header => {\n      if (bigCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_BIG);\n      } else if (mediumCells.has(header)) {\n        colWidths.push(HORIZ_CELL_WIDTH_MEDIUM);\n      } else {\n        colWidths.push(HORIZ_CELL_WIDTH_SMALL);\n      }\n    });\n    const resultRows: Publication[] = result.queryResult.map((publication: Publication) => ({\n      ...publication,\n      publishedTime: dateFormat(publication.publishedTime, 'ddd mmm dd yyyy HH:MM:ss Z'),\n    }));\n    const tableString = table.printTableJsonArray(headers, resultRows, colWidths);\n    Log.log(tableString);\n  } else {\n    throw new Error('No records found matching your query.');\n  }\n}\n"],"file":"publishHistoryAsync.js"}